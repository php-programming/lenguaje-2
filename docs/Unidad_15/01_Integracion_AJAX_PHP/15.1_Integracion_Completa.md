# 15.1 Integraci칩n de AJAX y PHP en POO

## Caso de Uso: Tabla de Datos Din치mica

**Objetivo:** Crear una tabla de usuarios que se pueda filtrar y paginar sin recargar la p치gina.

### 1. El Backend (API JSON)

Necesitamos un Controlador que devuelva JSON, no HTML.

```php
// controllers/ApiUsuarioController.php
class ApiUsuarioController {
    public function listar() {
        $repo = new UsuarioRepository();
        $usuarios = $repo->obtenerTodos();

        // Cabecera obligatoria para JSON
        header('Content-Type: application/json');
        echo json_encode($usuarios);
        exit;
    }
}
```

### 2. El Frontend (JavaScript + DOM)

```javascript
// app.js
const tabla = document.getElementById('tabla-usuarios');

function cargarUsuarios() {
    fetch('index.php?url=api/usuarios')
        .then(res => res.json())
        .then(usuarios => {
            tabla.innerHTML = ''; // Limpiar tabla
            usuarios.forEach(user => {
                // Crear fila
                let fila = `<tr>
                    <td>${user.id}</td>
                    <td>${user.nombre}</td>
                    <td>${user.email}</td>
                </tr>`;
                tabla.innerHTML += fila;
            });
        });
}

// Cargar al iniciar
document.addEventListener('DOMContentLoaded', cargarUsuarios);
```

### 3. Formulario AJAX (POST)

Para enviar datos sin recargar:

```javascript
const form = document.getElementById('form-crear');

form.addEventListener('submit', (e) => {
    e.preventDefault(); // Evitar recarga

    const datos = new FormData(form);

    fetch('index.php?url=api/usuarios/guardar', {
        method: 'POST',
        body: datos
    })
    .then(res => res.json())
    .then(respuesta => {
        if(respuesta.exito) {
            alert('Guardado!');
            cargarUsuarios(); // Recargar tabla
        }
    });
});
```

**Conclusi칩n:** Esta arquitectura (Frontend desacoplado del Backend mediante API JSON) es la base de las aplicaciones modernas (SPA - Single Page Applications).
