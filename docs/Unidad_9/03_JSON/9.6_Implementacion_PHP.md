# 9.6 Implementación Práctica en PHP

## Codificación (Encoding)

El proceso de **Codificación (Encoding)** es convertir una variable de PHP (generalmente un array o un objeto) en una cadena de texto en formato JSON.
La función clave para esto es: `json_encode()`.

**Escenario**: El `ProductoController` (Unidad I) obtiene datos del `ProductoModel` (Unidad II) y decide devolverlos como un API en formato JSON en lugar de una Vista HTML.

### a. Recuperamos los datos del Modelo (Array de PHP):

```php
// Simulando la llamada del Modelo (que devuelve un array asociativo)
$productos_php = [
    [
        'id' => 101,
        'nombre' => 'Monitor 4K',
        'stock' => 15,
        'creado_en' => new DateTime() // Un objeto PHP
    ],
    [
        'id' => 102,
        'nombre' => 'Teclado RGB',
        'stock' => 50,
        'creado_en' => new DateTime()
    ]
];
```

### b. Convertimos el Array PHP a Cadena JSON:

```php
// Aplicamos la codificación
$productos_json = json_encode($productos_php);

// Resultado: una cadena de texto JSON
/*
[
    {"id":101,"nombre":"Monitor 4K","stock":15,"creado_en":{}},
    {"id":102,"nombre":"Teclado RGB","stock":50,"creado_en":{}}
]
*/
```

### c. Lógica en el Controlador (Acción API):

Para que el navegador o cliente entienda que se está enviando JSON, es fundamental incluir la cabecera HTTP correcta.

```php
public function apiListar() {
    // 1. Obtener datos (del modelo)
    $datos_para_enviar = $this->modelo->obtenerTodos();

    // 2. Configurar cabecera HTTP
    header('Content-Type: application/json');

    // 3. Imprimir JSON
    echo json_encode($datos_para_enviar);
    
    exit; // Detenemos la ejecución para asegurar que no se imprima HTML adicional.
}
```

## Decodificación (Decoding)

El proceso de **Decodificación (Decoding)** es convertir una cadena de texto en formato JSON (usualmente recibida de una petición, como un POST o un servicio externo) de vuelta a una variable de PHP.
La función clave para esto es: `json_decode()`.

**Escenario**: El Controlador recibe datos JSON de un formulario o una aplicación móvil.

```php
// 1. Simulamos la recepción de una cadena JSON (ej. a través de un POST)
$json_recibido = '{"nombre_nuevo":"Memoria RAM 16GB","precio":45.99,"stock":10}';

// 2. Decodificamos la cadena JSON
$datos_php_objeto = json_decode($json_recibido);

// Por defecto, json_decode() devuelve un OBJETO estándar de PHP
echo "Accediendo como Objeto (por defecto): " . $datos_php_objeto->nombre_nuevo . "<br>";
// Salida: Accediendo como Objeto (por defecto): Memoria RAM 16GB


// 3. Decodificamos la cadena JSON como ARRAY ASOCIATIVO
// Esto se logra pasando TRUE como segundo argumento.
$datos_php_array = json_decode($json_recibido, true);

echo "Accediendo como Array Asociativo: " . $datos_php_array['precio'] . "<br>";
// Salida: Accediendo como Array Asociativo: 45.99

// 4. El Controlador podría usar estos datos para llamar al Modelo y Guardar:
// $this->modelo->guardar($datos_php_array);
```
