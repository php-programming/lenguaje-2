# 3.2 Motores de Bases de Datos en MySQL

## Caso de Uso

**Escenario:** El SISA necesita dos tipos de funcionalidades muy diferentes:
1.  **Transacciones Críticas:** El proceso de inscripción de un estudiante en un curso debe ser **atómico**. Debe registrar la inscripción y actualizar el cupo del curso. Si una de las dos operaciones falla, ambas deben revertirse (`ROLLBACK`) para evitar inconsistencias.
2.  **Búsqueda Rápida de Texto:** El sistema tendrá una sección de "Biblioteca" con miles de artículos. Se necesita una forma de realizar búsquedas de texto completo (`FULLTEXT search`) de manera muy eficiente en los títulos y contenidos de estos artículos.

**Problema:** ¿Puede una única configuración de tabla satisfacer óptimamente ambos requisitos: transacciones seguras y búsquedas de texto ultra-rápidas? La respuesta está en la elección del **motor de almacenamiento**.

---

## ¿Qué es un Motor de Almacenamiento?

Un motor de almacenamiento (o "storage engine") es el componente interno de la base de datos que se encarga de las operaciones CRUD (Crear, Leer, Actualizar, Borrar) para las tablas. MySQL tiene una arquitectura "enchufable" que permite elegir diferentes motores para diferentes tablas, según las necesidades.

Cada motor tiene sus propias ventajas y desventajas en términos de rendimiento, capacidades y fiabilidad. Los dos más conocidos son **InnoDB** y **MyISAM**.

## Comparativa: InnoDB vs. MyISAM

| Característica | InnoDB | MyISAM |
| :--- | :--- | :--- |
| **Transaccional (ACID)**| **Sí** (Soporta `COMMIT`, `ROLLBACK`) | No |
| **Claves Foráneas (FK)**| **Sí** (Garantiza integridad referencial) | No |
| **Tipo de Bloqueo** | A nivel de Fila (`Row-level locking`) | A nivel de Tabla (`Table-level locking`) |
| **Recuperación (Crash-safe)** | **Sí** (Diseñado para recuperarse de fallos) | No (Propenso a corrupción) |
| **Búsqueda `FULLTEXT`** | Soportado (desde MySQL 5.6) | Soportado (tradicionalmente su fortaleza) |
| **Uso Típico** | **OLTP**, aplicaciones de propósito general | Aplicaciones web antiguas, read-only, o tablas de logs. |
| **Default en MySQL** | **Sí** (desde la versión 5.5) | No |

### Análisis Técnico

*   **InnoDB: El Estándar Moderno para la Integridad**
    *   **Transacciones ACID:** Esto es crucial para el caso de uso 1. La inscripción y la actualización del cupo se envuelven en una transacción. Si algo falla, un `ROLLBACK` deshace todo, garantizando que la base de datos nunca quede en un estado inconsistente.
    *   **Bloqueo a Nivel de Fila:** Cuando se actualiza una inscripción, InnoDB solo bloquea esa fila. Otros usuarios pueden seguir inscribiéndose en otros cursos. Esto permite una **alta concurrencia**.
    *   **Integridad Referencial:** InnoDB no permitirá crear una inscripción para un estudiante que no existe.

*   **MyISAM: El Antiguo Caballo de Batalla para la Velocidad de Lectura**
    *   **Bloqueo a Nivel de Tabla:** Cuando un usuario escribe en una tabla MyISAM, **toda la tabla se bloquea**. Esto es terrible para la concurrencia en escrituras, pero hace que las lecturas masivas (como un `COUNT(*)`) sean a veces más rápidas.
    *   **No Transaccional:** Si el servidor se apaga en medio de una serie de `INSERTs`, la tabla puede quedar corrupta. No hay `ROLLBACK`.

### Resolviendo el Caso de Uso

1.  **Tablas Transaccionales (Estudiantes, Cursos, Inscripciones):** Deben usar **InnoDB** sin lugar a dudas. La necesidad de transacciones ACID y la integridad referencial garantizada por las claves foráneas no es negociable.

2.  **Tabla de Búsqueda (Artículos):** Históricamente, se usaba **MyISAM** por su rendimiento superior en `FULLTEXT`. Sin embargo, desde MySQL 5.6, **InnoDB también tiene un excelente soporte para `FULLTEXT`**. Dada la robustez y seguridad ante fallos de InnoDB, hoy en día casi siempre es preferible usar InnoDB incluso para este caso de uso. Se podría considerar MyISAM solo si la tabla es de solo lectura y el rendimiento de la búsqueda es la única prioridad absoluta por encima de la fiabilidad.

**¿Cómo especificar un motor?**
```sql
CREATE TABLE Inscripciones (
    -- ... columnas ...
) ENGINE=InnoDB;

CREATE TABLE Articulos (
    -- ... columnas ...
) ENGINE=InnoDB; -- O ENGINE=MyISAM si se requiere explícitamente.
```

**Conclusión:** La elección del motor de almacenamiento es una decisión de arquitectura crítica. Para el 99% de las aplicaciones modernas, **InnoDB es la elección correcta** debido a su soporte para transacciones, claves foráneas y bloqueo a nivel de fila. MyISAM es en gran medida un motor legacy con casos de uso muy específicos y de nicho. Para el SISA, la integridad y la concurrencia son primordiales, por lo que estandarizaremos el uso de **InnoDB**.
