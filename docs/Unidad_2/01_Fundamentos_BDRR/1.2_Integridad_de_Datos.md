# 1.2 Reglas de Integridad de Datos

## Caso de Uso

**Escenario:** Architek-Pro está en producción. Un operador de datos intenta realizar las siguientes acciones:
1.  **Acción A:** Crear un nuevo registro en la tabla `Inscripciones` para un `ID_Estudiante` que no existe en la tabla `Estudiantes`.
2.  **Acción B:** Registrar un nuevo estudiante sin asignarle un `ID_Estudiante`.
3.  **Acción C:** Almacenar la fecha de inscripción de un estudiante en un formato inválido, como "Ayer por la tarde".

**Problema:** Un sistema de archivos simple o una hoja de cálculo permitirían estas operaciones, llevando a un estado de datos corrupto e inconsistente. Se necesita un sistema que **haga cumplir las reglas del negocio** a nivel de la capa de persistencia para prevenir la corrupción de datos.

---

## Garantías de un SGBDR

Un Sistema Gestor de Bases de Datos Relacionales (SGBDR) no es solo un almacén de datos; es un **guardián de la integridad**. Esto lo logra a través de la imposición de restricciones o "constraints". Las tres reglas de integridad fundamentales son:

### 1. Integridad de Entidad

**Regla:** Ningún atributo que forme parte de la **Clave Primaria (PK)** de una tabla puede contener un valor **NULO (`NULL`)**.

**Justificación:** La PK es el identificador único de una fila. Si se permitiera un valor nulo, tendríamos una entidad que no puede ser identificada, lo cual es una contradicción conceptual. Un estudiante sin `ID_Estudiante` no es un estudiante válido en nuestro sistema.

**Resolución del Caso de Uso (Acción B):** El SGBDR rechazará un `INSERT` en la tabla `Estudiantes` si el campo `ID_Estudiante` es `NULL`, devolviendo un error y protegiendo la base de datos.

### 2. Integridad Referencial

**Regla:** Si una tabla tiene una **Clave Foránea (FK)**, el valor de esa FK debe cumplir una de dos condiciones:
a.  Debe coincidir con un valor existente en la Clave Primaria (PK) de la tabla a la que referencia.
b.  Puede ser `NULL` (si la relación es opcional).

**Justificación:** Esta regla garantiza la validez de las relaciones entre tablas. Previene la existencia de registros "huérfanos". No puede existir una inscripción que no pertenezca a un estudiante válido.

**Diagrama de Integridad Referencial:**

```mermaid
graph TD
    subgraph "Tabla: ESTUDIANTES"
        E1["PK: 101 | Nombre: Ana"]
        E2["PK: 102 | Nombre: Luis"]
    end
    
    subgraph "Tabla: INSCRIPCIONES"
        I1["ID_Insc: 1 | FK_Est: 101"]
        I2["ID_Insc: 2 | FK_Est: 102"]
        I3["ID_Insc: 3 | FK_Est: 101"]
        I4{INSERT (FK_Est: 999)}
    end

    I1 -- "ref ✓" --> E1
    I2 -- "ref ✓" --> E2
    I3 -- "ref ✓" --> E1
    I4 -- "ref ❌" --> Error((Error: FK Constraint Violation))

```

**Resolución del Caso de Uso (Acción A):** El SGBDR detectará que el `ID_Estudiante = 999` no existe en la tabla `Estudiantes`. La operación `INSERT` fallará, previniendo la creación de un registro de inscripción huérfano.

### 3. Integridad de Dominio

**Regla:** Todos los valores en una columna deben pertenecer a un **dominio** predefinido. Un dominio es el conjunto de valores permitidos para un atributo.

**Justificación:** Asegura que los datos sean del tipo y formato correctos. Esto se implementa a través de:
*   **Tipos de Datos:** `INT`, `VARCHAR(255)`, `DATE`, `BOOLEAN`, etc.
*   **Restricciones `NOT NULL`:** El campo no puede estar vacío.
*   **Restricciones `UNIQUE`:** No puede haber valores duplicados en la columna.
*   **Restricciones `CHECK`:** El valor debe cumplir una condición (ej. `precio > 0`).
*   **Valores por Defecto (`DEFAULT`):** Si no se proporciona un valor, se usa uno predefinido.

**Resolución del Caso de Uso (Acción C):** La columna `FechaInscripcion` se define con el tipo de dato `DATE`. El SGBDR rechazará la cadena "Ayer por la tarde" porque no se puede convertir a un formato de fecha válido.

**Conclusión:** Estas tres reglas de integridad no son características opcionales, son la esencia de un SGBDR. Transforman la base de datos de un contenedor pasivo de datos a un **agente activo que valida y protege la información**, garantizando que el estado del sistema permanezca lógico, consistente y fiable.
