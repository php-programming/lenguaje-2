# 12.3 Maquetación de Vistas

Con el Controlador de Vistas en su lugar, el último paso en el ciclo MVC es escribir el código de presentación que el usuario final verá. Esta unidad se enfoca en cómo la Vista utiliza los datos que le envía el Controlador para generar la interfaz final.

La maquetación se refiere a la **Estructuración y Codificación** del contenido HTML/CSS/PHP de los archivos de vista.

## Concepto Teórico: Separación de la Lógica

La clave de una buena maquetación en MVC es mantener la separación estricta.

- **Modelo y Controlador**: Gestionan la lógica.
- **Vista**: Solo itera e imprime. Se permite código PHP solo para:
  - Imprimir variables (`<?= $variable ?>`).
  - Estructuras de control (bucles `foreach`, condicionales `if`).

## Implementación Práctica: Archivos de Vista

Retomemos el ejemplo de la Unidad VIII, donde el `ProductoController` envió un array de datos llamado `$lista_productos` a la vista.

### a. Archivo de Layout Principal (`vistas/layouts/layout_principal.php`):

Este archivo define el esqueleto principal del sitio (cabecera, pie de página, CSS). Utiliza la variable `$contenido` (que fue capturada por `ob_get_clean()` en la clase `View`).

```php
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title><?= $titulo ?? 'Mi Aplicación MVC' ?></title>
    <link rel="stylesheet" href="<?= HelperUrl::crear('assets/css/estilos.css') ?>">
</head>
<body>

    <header>
        <h1>Mi Proyecto PHP POO | <?= $titulo ?? 'Bienvenido' ?></h1>
        <nav>
            <a href="<?= HelperUrl::crear('inicio') ?>">Inicio</a> |
            <a href="<?= HelperUrl::crear('productos/lista') ?>">Catálogo</a>
        </nav>
        <hr>
    </header>

    <main>
        <?= $contenido ?>
    </main>

    <footer>
        <hr>
        <p>&copy; <?= date('Y') ?> - Desarrollado con POO y MVC.</p>
    </footer>

</body>
</html>
```

### b. Archivo de Vista Específica (`vistas/productos/lista.php`):

Este archivo contiene el HTML específico para mostrar la lista de productos. Gracias a la función `extract()` en la clase `View`, las variables enviadas por el Controlador (`$lista_productos`) son accesibles directamente.

```php
<?php
// ¡Recordatorio! Las variables $titulo y $lista_productos existen aquí gracias al extract() en View.php

// 1. Mostrar título (del array de datos)
?>
<h2><?= $titulo ?></h2>

<?php
// 2. Verificar si hay productos para iterar
if (is_array($lista_productos) && count($lista_productos) > 0):
?>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Stock</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
        <?php
        // 3. Iteración: Usamos un bucle foreach para recorrer los datos
        // Este es uno de los pocos casos donde el PHP es necesario en la Vista.
        foreach ($lista_productos as $producto):
        ?>
            <tr>
                <td><?= $producto['id'] ?></td>
                <td><?= $producto['nombre'] ?></td>
                <td><?= $producto['stock'] ?></td>
                <td>
                    <a href="<?= HelperUrl::crear('producto/ver/' . $producto['id']) ?>">Ver</a>
                </td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>

<?php
else:
// 5. Caso de lista vacía
?>
    <p>Aún no hay productos registrados en el sistema.</p>
<?php
endif;
?>
```

## El Ciclo MVC Completo (Resumen)

Para finalizar la clase, repasamos el ciclo completo que hemos construido:

1.  **Petición (Cliente)**: El usuario pide `/producto/lista`.
2.  **Enrutamiento (Unidad V/VI)**: El `.htaccess` redirige a `index.php`. El Router determina que debe ejecutarse `ProductoController@listar`.
3.  **Controlador (Unidad I/VIII)**: `ProductoController` llama al...
4.  **Modelo (Unidad II)**: `ProductoModel` (que hereda de `ModeloBase`) consulta la base de datos y devuelve el array `$lista_productos`.
5.  **Controlador (Unidad VIII)**: `ProductoController` recibe los datos, los empaqueta, y se los pasa al `View.php`.
6.  **Vista (Unidad VIII/IX)**: `View.php` usa `extract()` para hacer los datos disponibles. Se carga el `layout_principal.php` y en su interior se inyecta el HTML generado por `vistas/productos/lista.php`.
7.  **Respuesta (Cliente)**: El HTML final se envía al navegador del usuario.
