# 11.2 Controlador POO de URI's

Para generar URLs de manera profesional y evitar codificar rutas a mano (ej. escribir `echo "/productos/lista"` en un archivo de Vista), usaremos una clase Helper que centralice la lógica de creación de enlaces. Esto facilita la migración del sitio web a otro dominio o subdirectorio.

## Diseño del Controlador POO de URI's (`HelperUrl.php`)

### a. Clase `HelperUrl.php` (El Generador de Enlaces):

```php
<?php
// core/HelperUrl.php

class HelperUrl {
    // 1. Propiedad Base: Almacena la ruta base del proyecto.
    // Esto es vital si el proyecto no está en la raíz del dominio.
    protected static $baseUrl = '';

    // Método estático para establecer la base del proyecto (llamado en index.php)
    public static function setBaseUrl($path) {
        // Asegura que la URL base termine sin barra
        self::$baseUrl = rtrim($path, '/');
    }

    // 2. Método Principal: Genera la URL completa
    public static function crear(string $uri = '/') {
        // Aseguramos que la URI comience con una barra para evitar doble barra
        $uri_limpia = ltrim($uri, '/');

        // Concatena la base del sitio con la URI deseada
        // Ejemplo: https://midominio.com/ + productos/lista
        return self::$baseUrl . '/' . $uri_limpia;
    }

    // Método para redirigir (convenience method)
    public static function redirigir(string $uri) {
        header('Location: ' . self::crear($uri));
        exit;
    }
}
?>
```

### b. Inicialización en el Punto de Entrada (`index.php`):

Necesitamos determinar la ruta base del proyecto automáticamente y configurarla.

```php
<?php
// public/index.php (Modificado)

require_once '../core/Autoload.php';
require_once '../core/Router.php';
require_once '../core/HelperUrl.php';

// Lógica para determinar la base del sitio (es complejo, pero crucial para la profesionalidad)
// Si la URL es http://localhost/mi_proyecto/public/index.php, queremos obtener /mi_proyecto
$base = str_replace(basename($_SERVER['SCRIPT_NAME']), '', $_SERVER['SCRIPT_NAME']);

// Inicializa el Helper de URL
HelperUrl::setBaseUrl($base);

$router = new Router();
$router->despachar();
?>
```

### c. Uso Profesional en Vistas (Ejemplo de `ProductoController`):

En cualquier lugar del código (Controlador, Vista o Modelo) donde se necesite un enlace, se usa el Helper.

```php
// En la lógica de ProductoController (para generar un enlace de redirección)
public function guardar() {
    // ... lógica para guardar en el modelo ...

    // Redirige al listado de productos usando el Helper
    HelperUrl::redirigir('productos/lista');
}

// En una Vista HTML (para el enlace de "Inicio")
?>
<a href="<?= HelperUrl::crear('inicio') ?>">Volver al Inicio</a>
<?php
// Resultado si $base es /mi_proyecto:
// <a href="/mi_proyecto/inicio">Volver al Inicio</a>
```

## Conclusión

Hemos:

- Formalizado la distinción entre URI y URL.
- Utilizado el POO (clase estática `HelperUrl`) para crear un Controlador de URI's que centraliza la generación de enlaces.
- Asegurado que la aplicación sea más portátil al manejar la ruta base de manera dinámica.
